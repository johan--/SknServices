===SknService
---

Author: James Scott <jscott@localhost.com>
Date: Dec 2015

This file contains a collection of notes and data used during development
The Readme.md file is more like documentation; outside of the app itself.



===PostgreSQL Required

```bash

    $ bundle install
    $ RAILS_ENV=development rake db:reset
    $ RAILS_ENV=production rake db:reset
    $ RAILS_ENV=test rake db:reset
    $ rspec
    $ bundle exec rails server
    $
    $ # to reload test data either db:seed or the following
    $ rake access_registry:reports:db_profiles access_registry:preload:create_content_profiles access_registry:reports:db_profiles
```


```ruby

      # Commission ids

      # Drawer IDs: FAGN, <RefId>27655173</RefId>
      # File Types: FAGN, <RefId>27635476</RefId>
      # Folder Names: Commission/30023 <RefId>27637844</RefId>
      # Document Type: STMT, <RefId>955</RefId>
      # {
      #   :id=>"c02ac7af-aed0-4582-895b-827d4c1a3ae5",
      #   :name=>"Statements",
      #   :ref_id=>"29734314",
      #   :type=>"955",
      #   :pages=>"2",
      #   :date=>Thu, 09 Jul 2015 17:35:27 +0000
      # },
```


=== Controller Layout
                                  Service               Role                Inherts from
                                  ----------------      ----------------    -----------------------
sessions_controller                None                  Login/Out           ActionController::Base
application_controller             service_factory       App/Security        ActionController::Base/Secure::ControllerAccessControl
users_controller                   access_service        Admin               ApplicationController
user_group_roles_controller        access_service        Admin               ApplicationController
password_resets_controller         access_service        Admin               ApplicationController
pages_controller                   access_service        Public Info         ApplicationController
profiles_controller                content_service       Features Demo       ApplicationController


=== Services Strategy Components Layout

ServiceFactory
    Factory::FactoriesBase
        +Factory::ObjectStorageService

ContentService
ProfilesService
    ContentProfileDomain
        Factory::DomainsBase

AccessService
    AccessProfileDomain
        Factory::DomainsBase

Providers::DBProfileProvider
Providers::XMLProfileProvider
    Factory::ProvidersBase
        +Factory::ObjectStorageService

Providers::InlineValuesAdapter
Providers::FileSystemAdapter
    Factory::ContentAdaptersBase
        Factory::DomainsBase

Secure::UserProfile
    +Factory::ObjectStorageService
    +Secure::UserAccessControl
    (proxy)User
        +Secure::UserProfileHelper

Secure::AccessRegistry
    Secure::AccessRegistryUtility
        +config/access_registry.xml
        +config/access_registry.xsd
        +config/content_registry.xml
        +config/content_registry.xsd

Secure::ControllerAccessControl
Secure::ObjectStorageContainer

Utility::ContentProfileBean
    SknUtils::PageControls


==== Special Helpers
    PageActionsBuilder
    Secure::ControllerAccessControl#page_action_paths
    ApplicationHelper#do_page_actions



=== Model Templates

rails generate model NAME [field[:type][:index] field[:type][:index]] [options]
rails generate scaffold NAME [field[:type][:index] field[:type][:index]] [options]


=== Model Generation (SimpleForm UI)
Make sure you edit config/initializers/generators.rb first

```bash

rails g model Users username:string:index name:string email:string password:digest remember_token:string:index password_reset_token:string password_reset_date:datetime assigned_groups:string roles:string active:boolean file_access_token:string


# Gem 'annotate'
bundle exec annotate
```


###Annoying Things

    poltergeist is the pits, signout_url fails because of the delete method
                javascript interactions are flaky
                webkit is no real alternative, since it has mac install issues


###Neat Thingys

    my_hash.try(:[], 'key1').try(:[], 'key2').try(:[], 'key3')

###UserProfile Required User Object Attributes

            :person_authenticated_key => String Secure Key 32chars
            :assigned_groups => Array
            :assigned_roles => Array
            :user_options => Array
            :roles => Array
            :username => String
            :display_name|:name => String
            :remember_token => String Secure Key 32chars
            :password => String
            :email => String


##Page Actions
---

Needs to be re-written

```ruby

    #  view/shared/page_actions.html.erb

        # link_to macro takes three params(hashes), path, text, html_options_hash
        # link_to(text, path, html_options_hash, &block)
        #         p1,   p2,   p3
        #

        # [{},{}]    = Two Items
        # [{},{},[{},{}]]

        ### usage
        # page_actions = [.]                    Single Button -- i.e. only one entry in array
        # page_actions = [...]                  Single Level menu(1) -- i.e. more than one entry in array
        # page_actions = [...,[...]]            Single Level Menu(1), With SubMenu(2)
        # page_actions = [...,[...,[...]]]      Single Level Menu(1), with SubMenu(2), with SubMenu(3)
        # page_actions << {
        # a0      icon_klass: 'desired-glyphicon-class',
        # a1      item_type: ':divider_pre|:divider_post'
        # a2      item_hdr: 'header text'
        #
        # p1      text: "text on button",
        # p2      path: :see page_action_paths helper,
        #
        # p3      id: 'id-string',
        # p3      klass: 'desired-bootstrap-class',             btn-default, btn-info, btn-lg
        # p3      method: 'html-method',
        # p3      data: { myKey: value, 'my-keys' => values, toggle: "modal" },
        # }


    page_actions: [
        {
           id: "test-action",
           path: :manage_content_profiles_profiles_path,
           text: "Refresh",
           icon_klass: 'glyphicon-refresh',
           data: {
               samples: 'test data'
           }
        },
        {
           id: "test-action",
           path: :manage_content_profiles_profiles_path,
           text: "Refresh",
           icon_klass: 'glyphicon-refresh',
           data: {
               samples: 'test data'
           }
        }
    ]

```


## Ajax Transaction

```
Parameters: {"id"=>"content", "user_options"=>["BranchPrimary", "0034", "0037", "0040"], "topic_value"=>"Branch", "content_value"=>["68601", "68602", "68603"], "content_type"=>"Commission", "content_type_description"=>"Monthly Commission Reports and Files", "topic_type"=>"Branch", "topic_type_description"=>"Branch Actions", "description"=>"Determine which branch documents can be seen", "username"=>"aptester"}

REQUEST: { ContentProfile
    "user_options":["Manager","0034","0037","0040"],
    "topic_value":"Branch",
    "content_value":["68601","68602","68603"],
    "content_type":"Commission",
    "content_type_description":"Monthly Commission Reports and Files",
    "topic_type":"Branch",
    "topic_type_description":"Branch Actions",
    "description":"Determine which branch documents can be seen",
    "username":"developer"
    }
RESPONSE: {
    "content":"content"
    "success":true,
    "message":"",
    "username":"developer",
    "display_name":"Employee Primary User: Developer",
    "package":[
        {"source":"datafiles","filename":"someFile.dat","created":"2016-01-05T16:24:12.066-05:00","size":"0"},
        {"source":"images","filename":"somePic.png","created":"2016-01-05T16:24:12.066-05:00","size":"0"},
        {"source":"pdfs","filename":"someFile.pdf","created":"2016-01-05T16:24:12.066-05:00","size":"0"}
              ]
    }

Parameters: {"id"=>"access", "user_options"=>["BranchPrimary", "0034", "0037", "0040"], "topic_value"=>"PDF", "content_value"=>{"doctype"=>"954"}, "content_type"=>"Commission", "content_type_description"=>"Branch Commission Statements", "topic_type"=>"Branch", "topic_type_description"=>"Branch Commission Statements", "description"=>"Branch Commission Statements", "uri"=>"Commission/Branch/PDF", "username"=>"aptester"}
REQUEST:  { AccessProfile
    "user_options":["Manager","0034","0037","0040"],
    "topic_value":"PDF",
    "content_value":{"doctype":"954"},
    "content_type":"Commission",
    "content_type_description":"Branch Commission Statements",
    "topic_type":"Branch",
    "topic_type_description":"Branch Commission Statements",
    "description":"Branch Commission Statements",
    "uri":"Commission/Branch/PDF",
    "username":"developer"
    }
RESPONSE: {
    "success":true,
    "content":"access"
    "message":"",
    "username":"developer",
    "display_name":"Employee Primary User: Developer",
    "package":[
        {"source":"datafiles","filename":"someFile.dat","created":"2016-01-05T16:18:57.881-05:00","size":"0"},
        {"source":"images","filename":"somePic.png","created":"2016-01-05T16:18:57.881-05:00","size":"0"},
        {"source":"pdfs","filename":"someFile.pdf","created":"2016-01-05T16:18:57.881-05:00","size":"0"}
              ]
    }
```

[jscott@iMac SknService]$ rake routes
                       Prefix Verb   URI Pattern                              Controller#Action
                        users GET    /users(.:format)                         users#index
                              POST   /users(.:format)                         users#create
                     new_user GET    /users/new(.:format)                     users#new
                    edit_user GET    /users/:id/edit(.:format)                users#edit
                         user GET    /users/:id(.:format)                     users#show
                              PATCH  /users/:id(.:format)                     users#update
                              PUT    /users/:id(.:format)                     users#update
                              DELETE /users/:id(.:format)                     users#destroy
             user_group_roles GET    /user_group_roles(.:format)              user_group_roles#index
                              POST   /user_group_roles(.:format)              user_group_roles#create
          new_user_group_role GET    /user_group_roles/new(.:format)          user_group_roles#new
         edit_user_group_role GET    /user_group_roles/:id/edit(.:format)     user_group_roles#edit
              user_group_role GET    /user_group_roles/:id(.:format)          user_group_roles#show
                              PATCH  /user_group_roles/:id(.:format)          user_group_roles#update
                              PUT    /user_group_roles/:id(.:format)          user_group_roles#update
                              DELETE /user_group_roles/:id(.:format)          user_group_roles#destroy
             content_profiles GET    /content_profiles(.:format)              content_profiles#index
                              POST   /content_profiles(.:format)              content_profiles#create
          new_content_profile GET    /content_profiles/new(.:format)          content_profiles#new
         edit_content_profile GET    /content_profiles/:id/edit(.:format)     content_profiles#edit
              content_profile GET    /content_profiles/:id(.:format)          content_profiles#show
                              PATCH  /content_profiles/:id(.:format)          content_profiles#update
                              PUT    /content_profiles/:id(.:format)          content_profiles#update
                              DELETE /content_profiles/:id(.:format)          content_profiles#destroy
              password_resets POST   /password_resets(.:format)               password_resets#create
           new_password_reset GET    /password_resets/new(.:format)           password_resets#new
          edit_password_reset GET    /password_resets/:id/edit(.:format)      password_resets#edit
               password_reset PATCH  /password_resets/:id(.:format)           password_resets#update
                              PUT    /password_resets/:id(.:format)           password_resets#update
     unauthenticated_sessions GET    /sessions/unauthenticated(.:format)      sessions#unauthenticated
                     sessions POST   /sessions(.:format)                      sessions#create
                  new_session GET    /sessions/new(.:format)                  sessions#new
                      session DELETE /sessions/:id(.:format)                  sessions#destroy
                   home_pages GET    /pages/home(.:format)                    pages#home
             learn_more_pages GET    /pages/learn_more(.:format)              pages#learn_more
                  about_pages GET    /pages/about(.:format)                   pages#about
              developer_pages GET    /pages/developer(.:format)               pages#developer
          details_architecture_pages GET    /pages/details_architecture(.:format)           pages#details_architecture
        details_content_pages GET    /pages/details_content(.:format)         pages#details_content
         details_access_pages GET    /pages/details_access(.:format)          pages#details_access
           details_auth_pages GET    /pages/details_auth(.:format)            pages#details_auth
  accessible_content_profiles GET    /profiles/accessible_content(.:format)   profiles#accessible_content
content_profile_demo_profiles GET    /profiles/content_profile_demo(.:format) profiles#content_profile_demo
 access_profile_demo_profiles GET    /profiles/access_profile_demo(.:format)  profiles#access_profile_demo
                      signout DELETE /signout(.:format)                       sessions#destroy
                       signin GET    /signin(.:format)                        sessions#new
                         root GET    /                                        pages#home
[jscott@iMac SknService]$


==Multilevel :page_actions Preferred
<div class="container">
    <div class="row">
        <h2>Multi level dropdown menu in Bootstrap 3 with Hover</h2>
        <hr>
        <div class="dropdown">
            <a id="dLabel" role="button" data-toggle="dropdown" class="btn btn-primary" data-target="#" href="/page.html">
                Dropdown <span class="caret"></span>
            </a>
            <ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
                <li><a href="#">Some action</a></li>
                <li><a href="#">Some other action</a></li>
                <li class="divider"></li>
                <li class="dropdown-submenu">
                    <a tabindex="-1" href="#">Hover me for more options</a>
                    <ul class="dropdown-menu">
                        <li><a tabindex="-1" href="#">Second level</a></li>
                        <li class="dropdown-submenu">
                            <a href="#">Even More..</a>
                            <ul class="dropdown-menu">
                                <li><a href="#">3rd level</a></li>
                                <li><a href="#">3rd level</a></li>
                            </ul>
                        </li>
                        <li><a href="#">Second level</a></li>
                        <li><a href="#">Second level</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>

<div class="dropdown">
    <a id="dLabel" role="button" data-toggle="dropdown" class="btn btn-primary" data-target="#" href="/page.html">
        Dropdown <span class="caret"></span>
    </a>
    <ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
        <li><a href="#">Some action</a></li>
        <li><a href="#">Some other action</a></li>
        <li class="divider"></li>

        <li class="dropdown-submenu">
            <a tabindex="-1" href="#">Hover me for more options</a>
            <ul class="dropdown-menu">
                <li><a tabindex="-1" href="#">Second level</a></li>
                <li class="dropdown-submenu">
                    <a href="#">Even More..</a>
                    <ul class="dropdown-menu">
                        <li><a href="#">3rd level</a></li>
                        <li><a href="#">3rd level</a></li>
                    </ul>
                </li>
                <li><a href="#">Second level</a></li>
                <li><a href="#">Second level</a></li>
            </ul>
        </li>

    </ul>
</div>

.dropdown:hover>.dropdown-menu {
    display: block;
}

.dropdown-submenu {
    position: relative;
}

.dropdown-submenu>.dropdown-menu {
    top: 0;
    left: 100%;
    margin-top: -6px;
    margin-left: -1px;
    -webkit-border-radius: 0 6px 6px 6px;
    -moz-border-radius: 0 6px 6px;
    border-radius: 0 6px 6px 6px;
}

.dropdown-submenu:hover>.dropdown-menu {
    display: block;
}

.dropdown-submenu>a:after {
    display: block;
    content: " ";
    float: right;
    width: 0;
    height: 0;
    border-color: transparent;
    border-style: solid;
    border-width: 5px 0 5px 5px;
    border-left-color: #ccc;
    margin-top: 5px;
    margin-right: -10px;
}

.dropdown-submenu:hover>a:after {
    border-left-color: #fff;
}

.dropdown-submenu.pull-left {
    float: none;
}

.dropdown-submenu.pull-left>.dropdown-menu {
    left: -100%;
    margin-left: 10px;
    -webkit-border-radius: 6px 0 6px 6px;
    -moz-border-radius: 6px 0 6px 6px;
    border-radius: 6px 0 6px 6px;
}


---

<div class="container">
	<div class="row">
        <h2>Multi level dropdown menu in Bootstrap 3</h2>
        <hr>
        <div class="dropdown">
            <a id="dLabel" role="button" data-toggle="dropdown" class="btn btn-primary" data-target="#" href="#">
                Dropdown <span class="caret"></span>
            </a>
    		<ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
              <li><a href="#">Some action</a></li>
              <li><a href="#">Some other action</a></li>
              <li class="divider"></li>
              <li class="dropdown-submenu">
                <a tabindex="-1" href="#">Hover me for more options</a>
                <ul class="dropdown-menu">
                  <li><a tabindex="-1" href="#">Second level</a></li>
                  <li class="dropdown-submenu">
                    <a href="#">Even More..</a>
                    <ul class="dropdown-menu">
                        <li><a href="#">3rd level</a></li>
                    	<li><a href="#">3rd level</a></li>
                    </ul>
                  </li>
                  <li><a href="#">Second level</a></li>
                  <li><a href="#">Second level</a></li>
                </ul>
              </li>
            </ul>
        </div>
	</div>
</div>

<div class="dropdown">
    <a id="dLabel" role="button" data-toggle="dropdown" class="btn btn-primary" data-target="#" href="#">
        Dropdown <span class="caret"></span>
    </a>
    <ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
      <li><a href="#">Some action</a></li>
      <li><a href="#">Some other action</a></li>
      <li class="divider"></li>
      <li class="dropdown-submenu">
        <a tabindex="-1" href="#">Hover me for more options</a>
        <ul class="dropdown-menu">
          <li><a tabindex="-1" href="#">Second level</a></li>
          <li class="dropdown-submenu">
            <a href="#">Even More..</a>
            <ul class="dropdown-menu">
                <li><a href="#">3rd level</a></li>
                <li><a href="#">3rd level</a></li>
            </ul>
          </li>
          <li><a href="#">Second level</a></li>
          <li><a href="#">Second level</a></li>
        </ul>
      </li>
    </ul>
</div>

.dropdown-submenu {
    position: relative;
}

.dropdown-submenu>.dropdown-menu {
    top: 0;
    left: 100%;
    margin-top: -6px;
    margin-left: -1px;
    -webkit-border-radius: 0 6px 6px 6px;
    -moz-border-radius: 0 6px 6px;
    border-radius: 0 6px 6px 6px;
}

.dropdown-submenu:hover>.dropdown-menu {
    display: block;
}

.dropdown-submenu>a:after {
    display: block;
    content: " ";
    float: right;
    width: 0;
    height: 0;
    border-color: transparent;
    border-style: solid;
    border-width: 5px 0 5px 5px;
    border-left-color: #ccc;
    margin-top: 5px;
    margin-right: -10px;
}

.dropdown-submenu:hover>a:after {
    border-left-color: #fff;
}

.dropdown-submenu.pull-left {
    float: none;
}

.dropdown-submenu.pull-left>.dropdown-menu {
    left: -100%;
    margin-left: 10px;
    -webkit-border-radius: 6px 0 6px 6px;
    -moz-border-radius: 6px 0 6px 6px;
    border-radius: 6px 0 6px 6px;
}

---

Every User produces the following json object.
{
  "user_options":["Manager","0034","0037","0040"],
  "username":"developer",
  "display_name":"Employee Primary User: Developer",
  "package":{
    "success":true,
    "message":"AccessProfile Entries for developer:Employee Primary User: Developer Options=Manager,0034,0037,0040",
    "user_options":["Manager","0034","0037","0040"],
    "accessible_content_url":"/profiles/accessible_content.json?id=access",
    "page_user":"developer",
    "access_profile":{
        "username":"developer","entries":[
           {"user_options":["Manager","0034","0037","0040"],
            "topic_value":"PDF",
            "content_value":{"doctype":"954"},
            "content_type":"Commission",
            "content_type_description":"Branch Commission Statements",
            "topic_type":"Branch",
            "topic_type_description":"Branch Commission Statements",
            "description":"Branch Commission Statements",
            "username":"developer",
            "uri":"Commission/Branch/PDF"
           },
           {"user_options":["Manager","0034","0037","0040"],"topic_value":"CSV","content_value":{"doctype":"955"},"content_type":"Commission","content_type_description":"Branch Commission CSV Datafiles","topic_type":"Branch","topic_type_description":"Branch Commission CSV Datafiles","description":"Branch Commission CSV Datafiles","username":"developer","uri":"Commission/Branch/CSV"},
           {"user_options":["Manager","0034","0037","0040"],"topic_value":"PDF","content_value":{"doctype":"956"},"content_type":"Experience","content_type_description":"Branch Experience Statements","topic_type":"Branch","topic_type_description":"Branch Experience Statements","description":"Branch Experience Statements","username":"developer","uri":"Experience/Branch/PDF"}
                                     ],
        "pak":null,
        "profile_type":"",
        "profile_type_description":"",
        "provider":"UserProfile",
        "display_name":"Employee Primary User: Developer",
        "email":"developer@gmail.com"
    }
  }
}

# WIP Notes
        <p class="lead">
            This application demonstrates and explores methods for Authentication, Access Authorizations,
            and Content Authorizations.  Referred to as UserProfiles, AccessProfiles, and ContentProfiles in
            this application.
        </p>

        <ul class="lead">
            <li>
                UserProfiles deal with userid, password, password resets, and some preferences management.
            </li>
            <li>
                AccessProfiles deal with what each user is allowed to access, click, or view.
            </li>
            <li>
                ContentProfiles deal with specific content access priviledges; which document, etc.
            </li>
        </ul>

        <p>
            UserProfiles and AccessProfiles have many different implementations available, and are well handled processes.  However,
            ContentProfiles are the main focus of exploration in this app, which has proven to be a significant
            engineering challenge to handle the dynamics of Electronic Delivery.
        </p>

     <div class="row">
         <div class="col-md-6">
            <h4>All secured page elements shall be assigned an unique id, called URI, by a developer.</h4>
            <p>
                Authorizations are evaluated for each <em>page access</em>, <em>clickable control</em>, and
                for each <em>showable data element</em>.  Page Access authorization is automated by examining the
                the controller name and method to compose the URI for the page.  Clickable (menu items, buttons, etc)
                authorization requires the developer to use programming helpers to implement authorization.  Showable Data Elements
                have two levels of authorization available; Clickable, and content-based
                authorization using the expanded UserProfile permissions, both use the Secure::AccessRegistry.
            </p>
        </div>
        <div class="panel panel-info col-md-6">
            <div class="panel-body">
                <p>
                    A user might have general access to the Account page which could list five
                    sensitive documents types, but is only allowed to view two document types for that specific
                    account.  Content-based authorization requires a document-type permissions list by account, to
                    enforce access restrictions.
                </p>
            </div>
        </div>
    </div>

ContentProfile's implementation encdoes the requirements by:

        <p>
            Secure::AccessRegistry is the controlling class which maps all the pre-defined (URIs) of the
            application to access role strings; which could be externally administered via LDAP or SQL.  The
            Secure::AccessRegistry uses the UserProfile permissions tuples to enable Content-based authorizations; which
            also could be administered via LDAP or SQL.
        </p>


AccessprofileEntry
["BranchSecondary", "0037"],
[
  {
     :uri=>"Commission/Branch/CSV",
     :resource_options=>{
            :uri=>"Commission/Branch/CSV",
            :role=>"Test.Branch.Commission.Statement.CSV.Access",
            :role_opts=>["0034", "0037", "0040"]
     },
     :content_type=>"Commission",
     :content_value=>{"doctype"=>"955"},
     :topic_type=>"Branch",
     :topic_value=>"CSV",
     :description=>"Branch Commission CSV Datafiles",
     :topic_type_description=>"Branch Commission CSV Datafiles",
     :content_type_description=>"Branch Commission CSV Datafiles"
  }
 ]


PAYLOAD From Demo Page : UsersTable EntryData to Content/Access Table Rows
aptester Selected.
{"username":"aptester","user_options":["BranchPrimary","0034","0037","0040"],"display_name":"Branch Primary User",
 "package":[
            {"success":true,"accessible_content_url":"/profiles/api_accessible_content.json?id=access",
             "access_profile":{"success":true,"pak":"589481242bc592029428433bf75024b1","profile_type_description":"","provider":"UserProfile","username":"aptester","email":"appdev2@localhost.com","profile_type":"BranchPrimary","display_name":"Branch Primary User",
                               "entries":[{"username":"aptester","content_type":"Commission","topic_type_description":"Branch Commission Statements","user_options":["BranchPrimary","0034","0037","0040"],"resource_options":{"role":"Test.Branch.Commission.Statement.PDF.Access","role_opts":["0034","0037","0040"],"uri":"Commission/Branch/PDF"},"topic_value":["PDF"],"description":"Branch Commission Statements","content_value":[{"doctype":"954"}],"content_type_description":"Branch Commission Statements","uri":"Commission/Branch/PDF","topic_type":"Branch"},
                                          {"username":"aptester","content_type":"Experience","topic_type_description":"Branch Experience Statements","user_options":["BranchPrimary","0034","0037","0040"],"resource_options":{"role":"Test.Branch.Commission.Experience.PDF.Access","role_opts":["0034","0037","0040"],"uri":"Experience/Branch/PDF"},"topic_value":["PDF"],"description":"Branch Experience Statements","content_value":[{"doctype":"956"}],"content_type_description":"Branch Experience Statements","uri":"Experience/Branch/PDF","topic_type":"Branch"}
                                         ]
                              },
             "user_options":["BranchPrimary","0034","0037","0040"],
             "page_user":"aptester",
             "message":"AccessProfile Entries for aptester:Branch Primary User Options=BranchPrimary,0034,0037,0040"
            },
            {"success":true,
             "content_profile":{"success":true,"pak":"589481242bc592029428433bf75024b1","profile_type_description":"Branch Super User","provider":"SknService::Bcrypt","username":"aptester","email":"appdev2@localhost.com","profile_type":"BranchPrimary","display_name":"Branch Primary User",
                                "entries":[{"username":"aptester","content_type":"Commission","topic_type_description":"Branch Actions for a specific branch","user_options":["BranchPrimary","0034","0037","0040"],"topic_value":["0038"],"description":"Determine which branch documents can be seen","content_value":["68613"],"content_type_description":"Monthly Commission Reports and Files","topic_type":"Branch"},
                                           {"username":"aptester","content_type":"Notification","topic_type_description":"Account Action again for a specific set of account","user_options":["BranchPrimary","0034","0037","0040"],"topic_value":["Producer"],"description":"Determine which accounts will have notification sent","content_value":["AdvCancel"],"content_type_description":"Email Notification of Related Events","topic_type":"Account"}
                                          ]
                               },
             "accessible_content_url":"/profiles/api_accessible_content.json?id=content",
             "user_options":["BranchPrimary","0034","0037","0040"],
             "page_user":"aptester",
             "message":"ContentProfile Entry for aptester, BranchPrimary:Branch Super User, Options=BranchPrimary,0034,0037,0040"
            }
          ]
}

PAYLOAD FROM BUILD PAGE: From Users to ContentProfile
eptester Selected.
{
 "pak":"2b546fa972156bf72bef3c70d78e9faf",
 "username":"eptester",
 "user_options":["Manager","0034","0037","0040"],
 "assigned_group":["EmployeePrimary"],
 "email":"appdev@localhost.com",
 "authentication_provider":"SknService::Bcrypt",
 "display_name":"Employee Primary User",
 "profile_exist":true,
 "profile_entries":[
        {"type_selects":[
            ["Branch",1,{"data-description":"Branch Actions for a specific branch"}]
         ],
         "content_type":"Commission",
         "topic_type_description":"Branch Actions for a specific branch",
         "topic_value":["0034"],
         "description":"Determine which branch documents can be seen",
         "content_value":["68601","68602","68603"],
         "content_type_description":"Monthly Commission Reports and Files",
         "topic_type":"Branch",
         "content_selects":[
             ["Commission",1,{"data-description":"Monthly Commission Reports and Files"}]
         ]
        },
        {"type_selects":[
             ["Account",2,{"data-description":"Account Action again for a specific set of account"}]
         ],
         "content_type":"Notification",
         "topic_type_description":"Account Action again for a specific set of account",
         "topic_value":["Branch"],
         "description":"Determine which accounts will have notification sent",
         "content_value":["AdvCancel","FutCancel","Cancel"],
         "content_type_description":"Email Notification of Related Events",
         "topic_type":"Account",
         "content_selects":[
             ["Notification",2,{"data-description":"Email Notification of Related Events"}]
         ]
        },
        {"type_selects":[
             ["LicensedStates",3,{"data-description":"Producer Actions"}]
         ],
         "content_type":"Operations",
         "topic_type_description":"Producer Actions",
         "topic_value":["USA"],
         "description":"Determine which States producer may operate in.",
         "content_value":["21","9","23"],
         "content_type_description":"Business Operational Metric",
         "topic_type":"LicensedStates",
         "content_selects":[
             ["Operations",3,{"data-description":"Business Operational Metric"}]
         ]
        }
 ]
}


<div class="pull-left">
    <div class="dropdown" role="group">
        <a id="dLabel" role="button" data-toggle="dropdown" data-target="#" class="btn btn-primary" href="#">
            <span>Actions</span><span class="caret" />
        </a>
        <ul class="dropdown-menu" role="menu">
            <li>
                <a data-samples="test data" href="/profiles/manage_content_profiles">
                    <span class="glyphicon glyphicon-refresh"></span>&nbsp;
                    <span>Refresh</span>
                </a>
            </li>
            <li class="divider"></li>
            <li class="dropdown-header">
                <span>Header Test</span>
            </li>
            <li>
                <a href="/profiles/manage_content_profiles">
                    <span>Refresh 2</span>
                </a>
            </li>
            <li>
                <a href="/profiles/manage_content_profiles">
                    <span>Refresh 3</span>
                </a>
            </li>
            <li>
                <a href="/profiles/manage_content_profiles">
                    <span>Refresh 4</span>
                </a>
            </li>
            <li class="dropdown-submenu" role="menu">
                <a data-toggle="dropdown" data-target="#">
                    <span>Rspec Testing</span>
                    <span class="caret" />
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li>
                        <a data-samples="test data" href="/profiles/manage_content_profiles">
                            <span class="glyphicon glyphicon-refresh"></span>&nbsp;
                            <span>Refresh</span>
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</div>

##
module Utility

  # Print Performance Elements of 'process_action.action_controller' event
  class LogRequestDuration

    def call(name, start, finish, id, payload)

      message_format = %Q(EventID=@id RequestId=@uuid @method @action @status Duration:@durationms Logic:@logicms DB:@dbms View:@viewms User:@username Params:@requestparams)
      db = (payload[:db_runtime] * 100).round / 100.0 rescue 0
      view = (payload[:view_runtime] * 100).round / 100.0 rescue 0
      duration = ( ((finish - start).to_f * 100000).round / 100.0 rescue 0)
      logic = "%2.2f" % (duration - (db + view))

      message = message_format.clone
      message.sub!(/@id/, id)
      message.sub!(/@uuid/,  payload.fetch(:uuid, 'na'))
      message.sub!(/@method/, payload[:method])
      message.sub!(/@action/, "#{payload[:controller]}##{payload[:action]}")
      message.sub!(/@status/, payload[:status].to_s)
      message.sub!(/@duration/, '%2.2f' % duration)
      message.sub!(/@logic/, logic)
      message.sub!(/@db/, '%2.2f' % db)
      message.sub!(/@view/, '%2.3f' % view)
      message.sub!(/@username/, payload.fetch(:username,'no-user'))
      message.sub!(/@requestparams/, payload.fetch(:params,'none').inspect )

      if payload[:exception].present? || payload[:status] == 500
        message += " EXCEPTION: #{payload[:exception]}"
      end

      Rails.logger.perf(message)
    end

  end
end

module Utility
  # Print Performance Elements of 'sql.active_record' event
  class LogSQLRequests

    def call(name, start, finish, id, payload)

      message_format = %Q(EventID=@id Operation:@name Conn:@conn_id SQL:@sql Params:@params Duration:@durationms)
      duration = ( ((finish - start).to_f * 100000).round / 100.0 rescue 0)

      message = message_format.clone
      message.sub!(/@id/, id)
      message.sub!(/@name/,  payload.fetch(:name, 'na'))
      message.sub!(/@conn_id/, payload.fetch(:connection_id, 'na'))
      message.sub!(/@sql/, payload.fetch(:sql, 'na'))
      message.sub!(/@params/, payload.fetch(:bind, 'na'))
      message.sub!(/@duration/, '%2.2f' % duration)

      Rails.logger.idata(message)
    end

  end
end

ActiveSupport::Notifications.subscribe('process_action.action_controller', Utility::LogRequestDuration.new)
ActiveSupport::Notifications.subscribe('sql.active_record', Utility::LogSQLRequests.new)

==OR
# Notification Publish/Interceptors
#      vendor/bundle/gems/actionpack-4.2.5/lib/action_controller/metal/instrumentation.rb
#      vendor/bundle/gems/actionpack-4.2.5/lib/action_controller/log_subscriber.rb
##
# Ref: http://edgeguides.rubyonrails.org/active_support_instrumentation.html#sql-active-record
##

## REQUEST Ending Event
ActiveSupport::Notifications.subscribe('process_action.action_controller') do |name, start, finish, id, payload|

  message_format = %Q(EventID=@id RequestId=@uuid @method @action @status Duration:@durationms Logic:@logicms DB:@dbms View:@viewms User:@username Params:@requestparams)
  db = (payload[:db_runtime] * 100).round / 100.0 rescue 0
  view = (payload[:view_runtime] * 100).round / 100.0 rescue 0
  duration = ( ((finish - start).to_f * 100000).round / 100.0 rescue 0)
  logic = "%2.2f" % (duration - (db + view))

  message = message_format.clone
  message.sub!(/@id/, id)
  message.sub!(/@uuid/,  payload.fetch(:uuid, 'na'))
  message.sub!(/@method/, payload[:method])
  message.sub!(/@action/, "#{payload[:controller]}##{payload[:action]}")
  message.sub!(/@status/, payload[:status].to_s)
  message.sub!(/@duration/, '%2.2f' % duration)
  message.sub!(/@logic/, logic)
  message.sub!(/@db/, '%2.2f' % db)
  message.sub!(/@view/, '%2.3f' % view)
  message.sub!(/@username/, payload.fetch(:username,'no-user'))
  message.sub!(/@requestparams/, payload.fetch(:params,'none').inspect )

  if payload[:exception].present? || payload[:status] == 500
    message += " EXCEPTION: #{payload[:exception]}"
  end

  Rails.logger.perf(message)

end


ActiveSupport::Notifications.subscribe('sql.active_record') do |name, start, finish, id, payload|

  message_format = %Q(EventID=@id SQL-Request Duration:@durationms PayLoad:@body)
  duration = ( ((finish - start).to_f * 100000).round / 100.0 rescue 0)

  message = message_format.clone
  message.sub!(/@id/, id)
  message.sub!(/@duration/, '%2.1f' % duration)
  message.sub!(/@body/,  payload.inspect)

  Rails.logger.idata(message)

end


